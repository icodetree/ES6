<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>amChart4 Treemap 차트</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji',
          'Segoe UI Symbol';
      }

      #chartdiv {
        width: 100%;
        height: 300px;
      }
    </style>
  </head>
  <body>
    <!-- <div class="container">
      <div class="treemap-chart-container" id="treemap-chart-01"></div>
      <div class="treemap-chart-container" id="treemap-chart-02"></div>
    </div> -->
    <div id="chartdiv"></div>

    <script src="./lib/core.js"></script>
    <script src="./lib/charts.js"></script>
    <script src="./lib/material.js"></script>
    <script src="./lib/de_DE.js"></script>
    <script src="./lib/germanyLow.js"></script>
    <script src="./lib/animated.js"></script>

    <script>
      /* getColor 함수 정의 */
      function getColor(value) {
        if (value >= 10) return { background: '#F26060', color: '#fff' }
        else if (value >= 5) return { background: '#FF8585', color: '#fff' }
        else if (value >= 3) return { background: '#FFA598', color: '#000' }
        else if (value >= 1) return { background: '#FBCBC1', color: '#000' }
        else if (value >= 0.5) return { background: '#F5DDD0', color: '#000' }
        else if (value >= 0) return { background: '#D7E2EB', color: '#000' }
        else if (value >= -0.5) return { background: '#CFEDDD', color: '#000' }
        else if (value >= -1) return { background: '#AEDDCE', color: '#000' }
        else if (value >= -3) return { background: '#78B4DF', color: '#000' }
        else if (value >= -5) return { background: '#6481CC', color: '#fff' }
        else if (value <= -10) return { background: '#485FB4', color: '#fff' }
        // Default color, in case no conditions are met
        return { background: '#D7E2EB', color: '#000' }
      }

      /* Set themes */
      am4core.useTheme(am4themes_animated)

      /* Create chart */
      const chart = am4core.create('chartdiv', am4charts.TreeMap)
      chart.data = [
        {
          name: 'First',
          children: [
            { name: 'A1', value: 9 },
            { name: 'A2', value: 4 },
            { name: 'A3', value: 1 }
          ]
        },
        {
          name: 'Second',
          children: [
            { name: 'B1', value: -1 },
            { name: 'B2', value: -6 },
            { name: 'B3', value: -9 }
          ]
        },
        {
          name: 'Third',
          children: [
            { name: 'C1', value: 4 },
            { name: 'C2', value: 4 },
            { name: 'C3', value: -1 },
            { name: 'C4', value: 3 }
          ]
        },
        {
          name: 'Fourth',
          children: [
            { name: 'D1', value: 6 },
            { name: 'D2', value: 1 },
            { name: 'D3', value: -4 },
            { name: 'D4', value: 2 },
            { name: 'D5', value: 5 }
          ]
        },
        {
          name: 'Fifth',
          children: [
            { name: 'E1', value: 3 },
            { name: 'E2', value: 6 }
          ]
        }
      ]

      /* Set color step */
      chart.colors.step = 2

      /* Define data fields */
      chart.dataFields.value = 'value'
      chart.dataFields.name = 'name'
      chart.dataFields.children = 'children'

      /* Create top-level series */
      const level1 = chart.seriesTemplates.create('0')
      const level1_column = level1.columns.template
      level1_column.fillOpacity = 0
      level1_column.strokeOpacity = 0

      /* Create second-level series */
      const level2 = chart.seriesTemplates.create('1')
      const level2_column = level2.columns.template
      level2_column.column.cornerRadius(10, 10, 10, 10)
      level2_column.fillOpacity = 0.8
      level2_column.stroke = am4core.color('#fff')
      level2_column.strokeWidth = 5
      level2_column.strokeOpacity = 1

      const level2_bullet = level2.bullets.push(new am4charts.LabelBullet())
      level2_bullet.locationY = 0.5
      level2_bullet.locationX = 0.5
      level2_bullet.label.text = '{name}'

      /* 레이블 색상 변경 */
      level2_bullet.label.adapter.add('fill', function (fill, target) {
        const dataItem = target.dataItem
        if (dataItem) {
          const colorInfo = getColor(dataItem.value)
          return am4core.color(colorInfo.color) // 여기서 커스텀 텍스트 색상 적용
        }
        return fill
      })

      /* 배경 색상 변경 */
      level2.columns.template.adapter.add('fill', function (fill, target) {
        const dataItem = target.dataItem
        if (dataItem) {
          const colorInfo = getColor(dataItem.value)
          return am4core.color(colorInfo.background) // 여기서 커스텀 배경 색상 적용
        }
        return fill
      })

      /* Add a navigation bar */
      chart.navigationBar = new am4charts.NavigationBar()

      /* Add a legend */
      chart.legend = new am4charts.Legend()
    </script>
  </body>
</html>
