<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>linechart</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      li {
        list-style: none;
      }

      .lineTooltip {
        padding: 10px;
      }
      .lineTooltip li {
        position: relative;
        margin: 2px 0;
      }
      .lineTooltip li:not(:first-child) {
        padding-left: 15px;
      }
      .lineTooltip li span {
        display: inline-block;
        font-size: 13px;
        font-weight: 400;
        color: rgba(255, 255, 255, 0.8);
        margin-right: 10px;
      }

      .lineTooltip li:first-child {
        font-family: pretendard;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .lineTooltip li::after {
        content: "";
        width: 10px;
        height: 10px;
        border-radius: 4px;
        position: absolute;
        left: 0;
        top: 50%;
        z-index: 1;
        transform: translate3d(0, -50%, 0);
      }

      .lineTooltip li:nth-child(2)::after {
        background-color: #f0295a;
      }
      .lineTooltip li:nth-child(3)::after {
        background-color: #26c1f8;
      }
      .lineTooltip li:nth-child(4)::after {
        background-color: #1db5ae;
      }
      .lineTooltip li:nth-child(5)::after {
        background-color: #5a56e1;
      }
      .lineTooltip li:nth-child(6)::after {
        background-color: #fecb27;
      }
      .lineTooltip li:nth-child(7)::after {
        background-color: #fe8fd6;
      }
      .lineTooltip li:nth-child(8)::after {
        background-color: #183dff;
      }
      .lineTooltip li:nth-child(9)::after {
        background-color: #8b00ff;
      }
      .lineTooltip li:nth-child(10)::after {
        background-color: #41e237;
      }

      .linechart-chkbox-top {
        display: flex;
      }
      .linechart-chkbox .inner {
        margin: 30px 10px;
      }
      .linechart-chkbox-bottom {
        display: flex;
      }
      .addbtn {
        padding: 10px 10px;
      }
      /* 차트 컨테이너 스타일 */
      #chartdiv {
        width: 100%;
        height: 500px;
      }
      /* 버튼 스타일 */
      .add-series-button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
      }
      .chart-legend {
        display: flex;
        padding: 10px;
        padding: 20px;
      }
      .chart-legend input[type="checkbox"] {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <!-- 체크박스 추가 -->
    <div id="chartLegend" class="chart-legend"></div>
    <!-- 차트를 표시할 div -->
    <div id="chartdiv"></div>
    <!-- 시리즈 추가 버튼 -->
    <button id="addSeriesButton" class="add-series-button">상품 추가</button>

    <script src="../lib/core.js"></script>
    <script src="../lib/charts.js"></script>
    <script src="../lib/animated.js"></script>
    <script src="../lib/material.js"></script>
    <script src="../lib/de_DE.js"></script>
    <script src="../lib/germanyLow.js"></script>

    <script>
      // amCharts 4 라이브러리 로드
      am4core.useTheme(am4themes_animated);

      // 차트 생성
      let chart = am4core.create("chartdiv", am4charts.XYChart);

      // 더미 데이터
      chart.data = [
        {
          date: "2024-03-01",
          value1: 1.23,
          value2: 7.56,
          value3: 9.89,
          value4: 1.23,
          value5: 7.56,
          value6: 9.89,
          value7: 1.23,
          value8: 7.56,
          value9: 9.89,
          specialDay: true,
        },
        {
          date: "2024-03-02",
          value1: 2.23,
          value2: -4.56,
          value3: 2.89,
          value4: 2.23,
          value5: -4.56,
          value6: 2.89,
          value7: 2.23,
          value8: -4.56,
          value9: 2.89,
          specialDay: true,
        },
        {
          date: "2024-03-03",
          value1: 5.23,
          value2: 2.56,
          value3: 6.89,
          value4: 5.23,
          value5: 2.56,
          value6: 6.89,
          value7: 5.23,
          value8: 2.56,
          value9: 6.89,
          specialDay: true,
        },
        {
          date: "2024-03-04",
          value1: 6.23,
          value2: 7.56,
          value3: 2.89,
          value4: 6.23,
          value5: 7.56,
          value6: 2.89,
          value7: 6.23,
          value8: 7.56,
          value9: 2.89,
          specialDay: true,
        },
        {
          date: "2024-03-05",
          value1: 21.23,
          value2: 14.56,
          value3: 12.89,
          value4: 21.23,
          value5: 14.56,
          value6: 12.89,
          value7: 21.23,
          value8: 14.56,
          value9: 12.89,
          specialDay: true,
        },
        {
          date: "2024-03-06",
          value1: 8.23,
          value2: 11.56,
          value3: 0.89,
          value4: 8.23,
          value5: 11.56,
          value6: 0.89,
          value7: 8.23,
          value8: 11.56,
          value9: 0.89,
          specialDay: true,
        },
        {
          date: "2024-03-07",
          value1: -1.23,
          value2: 18.56,
          value3: 17.89,
          value4: -1.23,
          value5: 18.56,
          value6: 17.89,
          value7: -1.23,
          value8: 18.56,
          value9: 17.89,
          specialDay: true,
        },
        {
          date: "2024-03-08",
          value1: -4.23,
          value2: 24.56,
          value3: -7.89,
          value4: -4.23,
          value5: 24.56,
          value6: -7.89,
          value7: -4.23,
          value8: 24.56,
          value9: -7.89,
          specialDay: true,
        },
        {
          date: "2024-03-09",
          value1: -10.23,
          value2: 34.56,
          value3: 1.89,
          value4: -10.23,
          value5: 34.56,
          value6: 1.89,
          value7: -10.23,
          value8: 34.56,
          value9: 1.89,
          specialDay: true,
        },
        {
          date: "2024-03-10",
          value1: 5.0,
          value2: 23.56,
          value3: 7.89,
          value4: 5.0,
          value5: 23.56,
          value6: 7.89,
          value7: 5.0,
          value8: 23.56,
          value9: 7.89,
          specialDay: true,
        },
      ];

      let dateAxis = chart.xAxes.push(new am4charts.DateAxis());
      dateAxis.renderer.minGridDistance = 60;
      let valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

      // 초기 3개 시리즈 생성
      for (let i = 1; i <= 3; i++) {
        createSeries(`value${i}`, `Series ${i}`);
      }

      function createSeries(field, name) {
        let series = chart.series.push(new am4charts.LineSeries());
        series.dataFields.valueY = field;
        series.dataFields.dateX = "date";
        series.name = name;

        series.strokeWidth = 2;
        series.tensionX = 0.8;
        series.showOnInit = true;

        return series;
      }

      // 범례 설정
      chart.legend = new am4charts.Legend();
      chart.legend.position = "top";
      chart.legend.paddingBottom = 20;
      chart.legend.labels.template.maxWidth = 95;

      // 마우스오버 시 툴팁 활성화
      chart.cursor = new am4charts.XYCursor();

      function createCheckboxLegend() {
        const legendContainer = document.getElementById("chartLegend");
        legendContainer.innerHTML = ""; // 범례 컨테이너 초기화

        chart.series.each((series, index) => {
          const id = `legend-checkbox-${index}`;
          const label = series.name;
          const input = document.createElement("input");
          input.type = "checkbox";
          input.id = id;
          input.checked = !series.hidden; // 시리즈가 숨겨져 있지 않으면 체크
          input.addEventListener("change", (event) => {
            series.hidden = !event.target.checked; // 체크박스 상태에 따라 시리즈 표시/숨김
          });

          const labelElement = document.createElement("label");
          labelElement.htmlFor = id;
          labelElement.textContent = label;

          const div = document.createElement("div");
          div.appendChild(input);
          div.appendChild(labelElement);

          legendContainer.appendChild(div);
        });
      }

      // 차트 시리즈 생성 후와 시리즈 추가 로직 후에 createCheckboxLegend 함수 호출
      createCheckboxLegend();

      // 시리즈 추가 기능
      const addBtn = document.getElementById("addSeriesButton");
      addBtn.addEventListener("click", function () {
        if (chart.series.length < 9) {
          let newSeriesNumber = chart.series.length + 1; // 시리즈 번호 1 증가

          createSeries(`value${newSeriesNumber}`, `Series ${newSeriesNumber}`);

          createCheckboxLegend(); // 범례 업데이트
        } else {
          alert("You can add up to 9 series.");
        }
      });
    </script>
  </body>
</html>
