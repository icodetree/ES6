<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>linechart</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      #chartdiv {
        width: 90%;
        height: 600px;
        border: 1px solid #ccc;
        padding: 0;
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <div id="chartdiv"></div>

    <script src="./lib/core.js"></script>
    <script src="./lib/charts.js"></script>
    <script src="./lib/animated.js"></script>
    <script src="./lib/material.js"></script>
    <script src="./lib/de_DE.js"></script>
    <script src="./lib/germanyLow.js"></script>

    <script>
      am4core.ready(function () {
        // Themes begin
        am4core.useTheme(am4themes_animated)

        // Create chart instance
        const chart = am4core.create('chartdiv', am4charts.XYChart)

        // Add data
        chart.data = generateChartData()

        function generateChartData() {
          let chartData = []
          let firstDate = new Date()
          firstDate.setDate(firstDate.getDate() - 150)
          let visits = -10,
            visits2 = -10,
            visits3 = -10 // 초기값 설정
          let b = 0.6
          for (let i = 0; i < 150; i++) {
            let newDate = new Date(firstDate)
            newDate.setDate(newDate.getDate() + i)
            if (i > 80) {
              b = 0.4
            }
            visits += Math.round(
              (Math.random() < b ? 1 : -1) * Math.random() * 10
            )
            // 예시를 위한 추가 데이터 변화, 실제 구현에 따라 조정 필요
            visits2 += Math.round(
              (Math.random() < b ? 1 : -1) * Math.random() * 10
            )
            visits3 += Math.round(
              (Math.random() < b ? 1 : -1) * Math.random() * 10
            )

            chartData.push({
              date: newDate,
              visits: visits,
              visits2: visits2, // 추가 필드
              visits3: visits3 // 추가 필드
            })
          }
          return chartData
        }

        // Chart and Series settings...
        chart.padding(20, 20, 20, 20)

        const dateAxis = chart.xAxes.push(new am4charts.DateAxis())
        dateAxis.renderer.minGridDistance = 70 // 날짜 레이블 간격 조정

        // 날짜 형식 : day
        dateAxis.dateFormats.setKey('day', 'yy.MM.dd')
        dateAxis.periodChangeDateFormats.setKey('day', 'yy.MM.dd')

        // 날짜 형식 : month
        dateAxis.dateFormats.setKey('month', 'yy.MM')
        dateAxis.periodChangeDateFormats.setKey('month', 'yy.MM')

        // 날짜 형식 : year
        dateAxis.dateFormats.setKey('year', 'yy')
        dateAxis.periodChangeDateFormats.setKey('year', 'yy')

        // dateAxis.title.text = "Turnover ($M)";
        dateAxis.renderer.grid.template.strokeOpacity = 0
        dateAxis.renderer.baseGrid.disabled = true
        dateAxis.renderer.labels.template.fill = am4core.color('#71747c')
        dateAxis.renderer.labels.template.fontSize = 14

        const valueAxis = chart.yAxes.push(new am4charts.ValueAxis())
        valueAxis.renderer.baseGrid.disabled = true
        valueAxis.renderer.grid.template.strokeOpacity = 1
        valueAxis.renderer.grid.template.stroke = am4core.color('#D4D8E2')
        valueAxis.renderer.grid.template.strokeDasharray = 3
        valueAxis.renderer.labels.template.fill = am4core.color('#71747c')
        valueAxis.renderer.labels.template.fontSize = 14
        valueAxis.renderer.inside = true
        valueAxis.renderer.maxLabelPosition = 0.99
        valueAxis.renderer.labels.template.dx = -10
        valueAxis.renderer.labels.template.dy = -10

        // Function to create series
        let series
        function createSeries(field, name, lineColor, startColor, endColor) {
          series = chart.series.push(new am4charts.LineSeries())
          series.dataFields.valueY = field
          series.dataFields.dateX = 'date'
          series.name = name
          series.strokeWidth = 2
          series.fillOpacity = 0.7
          series.tensionX = 0.7 // 곡선 효과 적용

          series.tooltipText = '{valueY.value}'
          series.stroke = am4core.color(lineColor) // 선 색상 설정

          let gradient = new am4core.LinearGradient()
          gradient.addColor(am4core.color(startColor))
          gradient.addColor(am4core.color(endColor))
          gradient.rotation = 90
          series.fill = gradient

          return series
        }

        // Create series for each data field
        createSeries(
          'visits',
          'NAV',
          'rgba(240, 41, 90, 1)',
          'rgba(240, 41, 90, 0.3)',
          'rgba(240, 41, 90, 0)'
        )
        createSeries(
          'visits2',
          '기초지수',
          'rgba(38, 193, 248, 1)',
          'rgba(72, 150, 255, 0.3)',
          'rgba(72, 150, 255, 0)'
        )
        createSeries(
          'visits3',
          '종가',
          'rgba(29, 181, 174, 1)',
          'rgba(29, 181, 174, 0.3)',
          'rgba(29, 181, 174, 0)'
        )

        // 특정 날짜 설정
        const targetDate = new Date(2024, 0, 1) // 2024년 1월 1일

        // 별모양 마커 추가
        const marker = series.bullets.push(new am4charts.CircleBullet())
        marker.preventOutlierNormalization = true
        marker.propertyFields.stroke = 'fill'
        marker.propertyFields.opacity = 1
        marker.radius = 10 // 마커 반지름
        marker.locationX = dateAxis.dateToPosition(targetDate)
        marker.locationY = 0 // y 좌표를 0으로 설정

        const starIcon = marker.createChild(am4core.Sprite)
        starIcon.path =
          'M3.5,2.5 L5,0.7 L6.5,2.5 L8.3,2.7 L6.8,4.2 L7.2,6 L5.5,5 L3.8,6 L4.2,4.2 L2.7,2.7 L3.5,2.5'
        starIcon.scale = 3
        starIcon.fill = am4core.color('#ffd700') // 노란색
        starIcon.stroke = am4core.color('#000000') // 검은색 외곽선
        starIcon.strokeWidth = 1
        starIcon.horizontalCenter = 'middle'
        starIcon.verticalCenter = 'middle'

        // Add cursor
        chart.cursor = new am4charts.XYCursor()
        chart.cursor.xAxis = dateAxis
        // chart.scrollbarX = new am4core.Scrollbar(); // hadle bar

        // Add legend
        chart.legend = new am4charts.Legend()
      }) // end am4core.ready()
    </script>
  </body>
</html>
