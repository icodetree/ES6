<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>linechart</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      #chartdiv {
        width: 90%;
        height: 600px;
        border: 1px solid #ccc;
        padding: 0;
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <div id="chartdiv"></div>

    <script src="./lib/core.js"></script>
    <script src="./lib/charts.js"></script>
    <script src="./lib/animated.js"></script>
    <script src="./lib/material.js"></script>
    <script src="./lib/de_DE.js"></script>
    <script src="./lib/germanyLow.js"></script>

    <script>
      am4core.ready(function () {
        // Themes begin
        am4core.useTheme(am4themes_animated)

        // Create chart instance
        const chart = am4core.create('chartdiv', am4charts.XYChart)

        // Add data
        chart.data = generateChartData()

        function generateChartData() {
          let chartData = []
          let firstDate = new Date()
          firstDate.setDate(firstDate.getDate() - 150)
          let visits = -10,
            visits2 = -10,
            visits3 = -10 // 초기값 설정
          let b = 0.6
          for (let i = 0; i < 150; i++) {
            let newDate = new Date(firstDate)
            newDate.setDate(newDate.getDate() + i)
            if (i > 80) {
              b = 0.4
            }
            visits += Math.round(
              (Math.random() < b ? 1 : -1) * Math.random() * 10
            )
            // 예시를 위한 추가 데이터 변화, 실제 구현에 따라 조정 필요
            visits2 += Math.round(
              (Math.random() < b ? 1 : -1) * Math.random() * 10
            )
            visits3 += Math.round(
              (Math.random() < b ? 1 : -1) * Math.random() * 10
            )

            chartData.push({
              date: newDate,
              visits: visits,
              visits2: visits2, // 추가 필드
              visits3: visits3 // 추가 필드
            })
          }
          return chartData
        }

        // Chart and Series settings...
        chart.padding(20, 20, 20, 20)

        const dateAxis = chart.xAxes.push(new am4charts.DateAxis())
        dateAxis.renderer.minGridDistance = 70 // 날짜 레이블 간격 조정

        // 날짜 형식 : day
        dateAxis.dateFormats.setKey('day', 'yy.MM.dd')
        dateAxis.periodChangeDateFormats.setKey('day', 'yy.MM.dd')

        // 날짜 형식 : month
        dateAxis.dateFormats.setKey('month', 'yy.MM')
        dateAxis.periodChangeDateFormats.setKey('month', 'yy.MM')

        // 날짜 형식 : year
        dateAxis.dateFormats.setKey('year', 'yy')
        dateAxis.periodChangeDateFormats.setKey('year', 'yy')

        // dateAxis.title.text = "Turnover ($M)";
        dateAxis.renderer.grid.template.strokeOpacity = 0
        dateAxis.renderer.baseGrid.disabled = true
        dateAxis.renderer.labels.template.fill = am4core.color('#71747c')
        dateAxis.renderer.labels.template.fontSize = 14

        const valueAxis = chart.yAxes.push(new am4charts.ValueAxis())
        valueAxis.renderer.baseGrid.disabled = true
        valueAxis.renderer.grid.template.strokeOpacity = 1
        valueAxis.renderer.grid.template.stroke = am4core.color('#D4D8E2')
        valueAxis.renderer.grid.template.strokeDasharray = 3
        valueAxis.renderer.labels.template.fill = am4core.color('#71747c')
        valueAxis.renderer.labels.template.fontSize = 14

        // Function to create series
        function createSeries(field, name, lineColor, startColor, endColor) {
          const series = chart.series.push(new am4charts.LineSeries())
          series.dataFields.valueY = field
          series.dataFields.dateX = 'date'
          series.name = name
          series.strokeWidth = 2
          series.fillOpacity = 0.7
          series.tensionX = 0.7 // 곡선 효과 적용

          series.tooltipText = '{valueY.value}'
          series.stroke = am4core.color(lineColor) // 선 색상 설정

          let gradient = new am4core.LinearGradient()
          gradient.addColor(am4core.color(startColor))
          gradient.addColor(am4core.color(endColor))
          gradient.rotation = 90
          series.fill = gradient

          return series
        }

        // Create series for each data field
        createSeries(
          'visits',
          'NAV',
          'rgba(240, 41, 90, 1)',
          'rgba(240, 41, 90, 0.3)',
          'rgba(240, 41, 90, 0)'
        )
        createSeries(
          'visits2',
          '기초지수',
          'rgba(38, 193, 248, 1)',
          'rgba(72, 150, 255, 0.3)',
          'rgba(72, 150, 255, 0)'
        )
        createSeries(
          'visits3',
          '종가',
          'rgba(29, 181, 174, 1)',
          'rgba(29, 181, 174, 0.3)',
          'rgba(29, 181, 174, 0)'
        )
        // Sprites 배열 생성
        chart.sprites = []
        // 별모양 오브젝트 생성
        let star = new am4core.Sprite()
        star.path =
          'M5.5,0 L7.5,4 L13,4.5 L9.5,8 L10,13.5 L5.5,11 L1,13.5 L1.5,8 L-2,4.5 L3.5,4 L5.5,0' // 별모양 SVG 경로
        star.scale = 1 // 크기 조정
        star.fill = am4core.color('#ffd700') // 노란색 채우기
        star.stroke = am4core.color('#000000') // 검은색 외곽선
        star.strokeWidth = 1 // 외곽선 두께
        star.horizontalCenter = 'middle' // 수평 위치 조정
        star.verticalCenter = 'bottom' // 수직 위치 조정
        star.align = 'center' // 정렬 방식
        star.valign = 'bottom' // 수직 정렬 방식
        star.y = 0 // y 좌표 설정 (0은 수평 기준선에 위치)

        // 차트에 별모양 오브젝트 추가
        chart.sprites.push(star)

        // Add cursor
        chart.cursor = new am4charts.XYCursor()
        chart.cursor.xAxis = dateAxis
        // chart.scrollbarX = new am4core.Scrollbar(); // hadle bar

        // Add legend
        chart.legend = new am4charts.Legend()
      }) // end am4core.ready()
    </script>
  </body>
</html>
